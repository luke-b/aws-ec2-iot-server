<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lehký IoT monitorovací stack – technický přehled</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 0; }
    header { background-color: #0b3a63; color: #fff; padding: 24px; }
    h1, h2, h3 { margin-top: 1.2em; }
    main { padding: 24px; }
    figure { margin: 20px auto; text-align: center; }
    figcaption { font-style: italic; color: #444; }
    code, pre { background-color: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    .callout { background: #eef6ff; border-left: 4px solid #2b78d4; padding: 12px; }
  </style>
</head>
<body>
  <header>
    <h1>Lehký IoT monitorovací stack – technický přehled</h1>
    <p>Přehledná a přátelská mapa toho, co skript <code>bootstrap_iot_stack.sh</code> nasazuje, proč to dává smysl
      na free‑tier EC2 a jak data pohodlně dostat z ESP32 až do Grafany.</p>
  </header>
  <main>
    <h2>Architektura</h2>
    <p>Stack je záměrně úsporný: dvě Docker služby – databáze time‑series (VictoriaMetrics nebo InfluxDB 1.8)
      a vizualizace v Grafaně. Senzory posílají data přes HTTP, databáze je ukládá na disk a Grafana je
      dotazuje přes předem připravený datasource.</p>
    <figure>
      <img src="iot_diagram.png" alt="Schéma IoT monitorovacího stacku" style="max-width:100%;height:auto;">
      <figcaption>Obrázek 1: Tok dat od senzoru až po dashboard v Grafaně.</figcaption>
    </figure>

    <h2>Komponenty</h2>
    <h3>VictoriaMetrics</h3>
    <p>Lehká time‑series databáze s Prometheus API na portu 8428. Umí ingestovat i InfluxDB line protocol.
      Retenci nastavíte parametrem <code>--vm-retention</code>.</p>

    <h3>InfluxDB 1.8</h3>
    <p>Klasická InfluxDB 1.x varianta s HTTP API na portu 8086. Hodí se, pokud potřebujete kompatibilitu
      s 1.x klienty nebo existujícími integracemi.</p>

    <h3>Grafana</h3>
    <p>Webové dashboardy na portu 3000. Skript nastaví výchozího admina i datasource a přidá ukázkový
      dashboard, takže po instalaci hned vidíte první graf.</p>

    <div class="callout">
      <strong>Tip:</strong> Pokud Grafana běží uvnitř Docker Compose, datasource pro VictoriaMetrics může
      být <code>http://victoriametrics:8428</code>. Pokud Grafanu provozujete mimo Docker, změňte URL na
      host‑dostupnou adresu (např. <code>http://localhost:8428</code> nebo <code>http://&lt;ec2-private-ip&gt;:8428</code>).
    </div>

    <h2>Porty a bezpečnost</h2>
    <ul>
      <li><strong>3000</strong> – Grafana (vždy)</li>
      <li><strong>8428</strong> – VictoriaMetrics (jen pro <code>--stack=vm</code>)</li>
      <li><strong>8086</strong> – InfluxDB (jen pro <code>--stack=influx</code>)</li>
    </ul>
    <p>Doporučení: omezte přístup na vlastní IP/VPN a změňte výchozí hesla.</p>

    <h2>Ingest dat</h2>
    <p>Obě databáze přijímají InfluxDB line protocol. Stačí poslat HTTP POST na odpovídající endpoint:</p>
    <table>
      <tr><th>Databáze</th><th>Endpoint</th><th>Příklad payloadu</th></tr>
      <tr><td>VictoriaMetrics</td><td><code>http://&lt;host&gt;:8428/write</code></td><td><code>temperature,room=office value=22.5</code></td></tr>
      <tr><td>InfluxDB 1.8</td><td><code>http://&lt;host&gt;:8086/write?db=iot</code></td><td><code>temperature,room=office value=22.5</code></td></tr>
    </table>

    <h2>ESP32 – jednoduchý příklad</h2>
    <pre><code>#include &lt;WiFi.h&gt;
#include &lt;HTTPClient.h&gt;

void sendMeasurement(float temperature) {
  HTTPClient client;
  client.begin("http://&lt;host&gt;:8428/write");
  client.addHeader("Content-Type", "text/plain");
  String line = "temperature value=" + String(temperature);
  client.POST(line);
  client.end();
}
</code></pre>

    <h2>Závěr</h2>
    <p>Tento stack je ideální pro rychlé PoC a malé IoT projekty. Stačí spustit skript, otevřít Grafanu
      a během pár minut máte první data na dashboardu. Kdykoli můžete upravit retenci, hesla nebo
      porty podle svých potřeb.</p>
  </main>
</body>
</html>
